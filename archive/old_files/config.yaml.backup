# Universal Training Configuration
# One config file to rule them all - easily switch between datasets and experiments

# ============================================================================
# DATASET CONFIGURATION
# ============================================================================
dataset:
  name: cattlebody              # Dataset name: cattlebody, cattleface
  root: dataset/cattlebody      # Auto-constructed: dataset/{name}
  format: yolo                  # Format: yolo, coco, voc
  # num_classes: auto-detected from dataset
  # class_names: auto-detected from data.yaml

# ============================================================================
# MODEL CONFIGURATION  
# ============================================================================
model:
  name: yolov8                  # Model: yolov8, faster_rcnn
  pretrained: false
  freeze_backbone: false
  
# ============================================================================
dataset:
  name: cattle                  # Default: cattle, Options: cattle, cattlebody, cattleface
  split: processed              # processed or raw
  root: dataset/${{dataset.name}}  # Auto-constructed
  format: auto                  # auto, yolo, coco, voc
  # num_classes: auto-detected from analysis
  # class_names: auto-detected from analysis

# =========================================================================
# DATASET-SPECIFIC OVERRIDES (auto-filled from deep analysis)
# =========================================================================
datasets:
  # Only dataset-specific issues and recommendations for reference/documentation.
  # num_classes, class_names, and image/label counts are always detected at runtime for robustness.
  cattle:
    issues:
      - "Class imbalance detected (ratio: 10.40)"
      - "Large aspect ratio variation (0.75 to 1.91)"
    recommendations:
      - "Use weighted loss or focal loss for class imbalance"
      - "Resize all images to consistent size (e.g., 640x640)"
    format: unknown
    has_data_yaml: false
  cattlebody:
    issues:
      - "train: Image/label mismatch (3424 images, 3432 labels)"
      - "Large aspect ratio variation (0.75 to 2.19)"
    recommendations:
      - "Resize all images to consistent size (e.g., 640x640)"
    format: yolo
    has_data_yaml: true
  cattleface:
    issues:
      - "train: Image/label mismatch (4565 images, 0 labels)"
      - "val: Image/label mismatch (979 images, 0 labels)"
      - "test: Image/label mismatch (984 images, 0 labels)"
    recommendations:
      - "Check label files"
    format: unknown
    has_data_yaml: false
  epochs: 100                   # Total epochs
  batch: 8                      # Batch size
  lr: 0.001                     # Learning rate
  wd: 0.0001                    # Weight decay
  momentum: 0.9
  
  # Optimizer
  opt: adamw                    # Optimizer: sgd, adam, adamw, rmsprop
  opt_params:
    betas: [0.9, 0.999]
    eps: 1.0e-8
  
# =========================================================================
# DATA AUGMENTATION & PREPROCESSING (from analysis)
# =========================================================================
preprocess:
  resize: [640, 640]
  aspect_pad: true
  normalize: true
aug:
  enabled: true
  h_flip: 0.5                   # Horizontal flip probability
  v_flip: 0.0                   # Vertical flip probability
  rotate: 10                    # Rotation degrees
  brightness: 0.2
  contrast: 0.2
  saturation: 0.2
  hue: 0.1
  scale: [0.8, 1.2]
  mosaic: true
# ============================================================================
# DATA AUGMENTATION (Short names!)
# ============================================================================
aug:
  enabled: true
  h_flip: 0.5                   # Horizontal flip probability
  v_flip: 0.0                   # Vertical flip probability
  rotate: 10                    # Rotation degrees
  brightness: 0.2
  contrast: 0.2
  saturation: 0.2
  hue: 0.1
  
# ============================================================================
# REGULARIZATION
# ============================================================================
reg:
  dropout: 0.3
  label_smooth: 0.0             # Label smoothing
  mixup: 0.0                    # Mixup alpha
  grad_clip: 1.0                # Gradient clipping

# ============================================================================
# TRAINING STRATEGY
# ============================================================================
strategy:
  warmup: 5                     # Warmup epochs
  early_stop: true
  early_stop_patience: 20
  mixed_precision: true

# ============================================================================
# VALIDATION
# ============================================================================
val:
  interval: 1                   # Validate every N epochs
  metric: mAP                   # Metric: mAP, loss, f1

# ============================================================================
# CHECKPOINTING
# ============================================================================
ckpt:
  save_interval: 5              # Save every N epochs
  save_best: false              # Save only best model
  dir: null                     # Auto: output/exp_name/checkpoints

# ============================================================================
# OUTPUT & LOGGING (Short names!)
# ============================================================================
output:
  dir: outputs                  # Output directory
  exp_name: null                # Auto-generated if null
  log_interval: 10              # Log every N batches
  save_pred: true               # Save predictions
  save_vis: true                # Save visualizations

# ============================================================================
# DEVICE & WORKERS
# ============================================================================
device:
  name: cuda                    # Device: cuda, cpu, cuda:0, cuda:1
  workers: 4                    # Num workers for dataloader
  pin_memory: true

# ============================================================================
# DEBUGGING
# ============================================================================
debug:
  enabled: false
  profile: false
  seed: 42

# ============================================================================
# VISUALIZATION CONFIG
# ============================================================================
vis:
  enabled: true
  save_interval: 10             # Save visualizations every N epochs
  num_samples: 8                # Number of samples to visualize
  show_gt: true                 # Show ground truth
  show_pred: true               # Show predictions
  conf_thresh: 0.5              # Confidence threshold for display
